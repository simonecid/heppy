'''
  Receives a ROOT file with trigger rates as an argument and plots them altogether
'''

from ROOT import TFile
from ROOT import TMultiGraph
from ROOT import TGraphErrors
from ROOT import TLegend
from ROOT import TCanvas
from ROOT import gStyle
from ROOT import TLine
from ROOT import TPaveText
from ROOT import TLatex

import sys

gStyle.SetOptStat(0)

mySettings = lambda a: None
'''Pile up level for that kind of event'''
mySettings.pileup = 180 # FCC
#mySettings.pileup = 40 # LHC
mySettings.yScale = 1e6
'''Cross section of the event in mb'''
mySettings.crossSection = 100 # FCC
#mySettings.crossSection = 60 # LHC
'''Instantaneous lumi in cm^-2 s^-1'''
mySettings.instantaneousLuminosity = 5e34 # FCC
#mySettings.instantaneousLuminosity = 1.15e34 # LHC

# Opening TFile

triggerRatesFile = TFile(sys.argv[1])

# Loading histograms
jetRatePlot_Histo = triggerRatesFile.Get("jetTriggerRate")
jetRatePlot = TGraphErrors(jetRatePlot_Histo)
jetToMuonRatePlot_Histo = triggerRatesFile.Get("jetToMuonTriggerRate")
jetToMuonRatePlot = TGraphErrors(jetToMuonRatePlot_Histo)
jetToElectronRatePlot_Histo = triggerRatesFile.Get("jetToElectronTriggerRate")
jetToElectronRatePlot = TGraphErrors(jetToElectronRatePlot_Histo)
# jetToPhotonRatePlot_Histo = triggerRatesFile.Get("photonTriggerRate")
# jetToPhotonRatePlot = TGraphErrors(#_Histo)
jetToMETRatePlot_Histo = triggerRatesFile.Get("jetToMETTriggerRate")
jetToMETRatePlot = TGraphErrors(jetToMETRatePlot_Histo)

# Setting up error bars

jetRatePlot.SetPointError(0, 5, 7071067.81186548)
jetRatePlot.SetPointError(1, 5, 1702321.99069389)
jetRatePlot.SetPointError(2, 5, 1702321.99069389)
jetRatePlot.SetPointError(3, 5, 1702321.99069389)
jetRatePlot.SetPointError(4, 5, 1074011.17312624)
jetRatePlot.SetPointError(5, 5, 724292.758489273)
jetRatePlot.SetPointError(6, 5, 518844.870842914)
jetRatePlot.SetPointError(7, 5, 391024.295920343)
jetRatePlot.SetPointError(8, 5, 308382.878902185)
jetRatePlot.SetPointError(9, 5, 250000)
jetRatePlot.SetPointError(10, 5, 206155.281280883)
jetRatePlot.SetPointError(11, 5, 178605.710994917)
jetRatePlot.SetPointError(12, 5, 150000)
jetRatePlot.SetPointError(13, 5, 126885.775404495)
jetRatePlot.SetPointError(14, 5, 113578.166916005)
jetRatePlot.SetPointError(15, 5, 96436.5076099296)
jetRatePlot.SetPointError(16, 5, 82462.1125123532)
jetRatePlot.SetPointError(17, 5, 71414.2842854285)
jetRatePlot.SetPointError(18, 5, 62449.979983984)
jetRatePlot.SetPointError(19, 5, 59160.7978309962)
jetRatePlot.SetPointError(20, 5, 57445.6264653803)
jetRatePlot.SetPointError(21, 5, 51961.5242270663)
jetRatePlot.SetPointError(22, 5, 50000)
jetRatePlot.SetPointError(24, 5, 42426.4068711929)
jetRatePlot.SetPointError(23, 5, 40000)
jetRatePlot.SetPointError(25, 5, 38729.8334620742)
jetRatePlot.SetPointError(26, 5, 36055.5127546399)
jetRatePlot.SetPointError(27, 5, 33166.247903554)
jetRatePlot.SetPointError(28, 5, 33166.247903554)
jetRatePlot.SetPointError(28, 5, 31622.7766016838)
jetRatePlot.SetPointError(29, 5, 30000)
jetRatePlot.SetPointError(30, 5, 30000)
jetRatePlot.SetPointError(31, 5, 28284.2712474619)
jetRatePlot.SetPointError(32, 5, 28284.2712474619)
jetRatePlot.SetPointError(33, 5, 26457.5131106459)
jetRatePlot.SetPointError(34, 5, 24494.8974278318)
jetRatePlot.SetPointError(35, 5, 22360.6797749979)
jetRatePlot.SetPointError(36, 5, 20000)
jetRatePlot.SetPointError(37, 5, 17320.5080756888)
jetRatePlot.SetPointError(38, 5, 14142.135623731)
jetRatePlot.SetPointError(39, 5, 14142.135623731)
jetRatePlot.SetPointError(40, 5, 14142.135623731)
jetRatePlot.SetPointError(41, 5, 14142.135623731)
jetRatePlot.SetPointError(42, 5, 14142.135623731)
jetRatePlot.SetPointError(43, 5, 14142.135623731)
jetRatePlot.SetPointError(44, 5, 14142.135623731)
jetRatePlot.SetPointError(45, 5, 14142.135623731)
jetRatePlot.SetPointError(46, 5, 14142.135623731)
jetRatePlot.SetPointError(47, 5, 14142.135623731)
jetRatePlot.SetPointError(48, 5, 14142.135623731)
jetRatePlot.SetPointError(49, 5, 14142.135623731)

jetToElectronRatePlot.SetPointError(0, 5, 7071067)
jetToElectronRatePlot.SetPointError(1, 5, 620805.915259667)
jetToElectronRatePlot.SetPointError(2, 5, 52380.4991000344)
jetToElectronRatePlot.SetPointError(3, 5, 37927.3613853953)
jetToElectronRatePlot.SetPointError(4, 5, 18951.9795194932)
jetToElectronRatePlot.SetPointError(5, 5, 11551.8825943873)
jetToElectronRatePlot.SetPointError(6, 5, 7001.6320954982)
jetToElectronRatePlot.SetPointError(7, 5, 4648.6673491476)
jetToElectronRatePlot.SetPointError(8, 5, 3313.4742578006)
jetToElectronRatePlot.SetPointError(9, 5, 2459.0488916183)
jetToElectronRatePlot.SetPointError(10, 5, 1867.4696307753)
jetToElectronRatePlot.SetPointError(11, 5, 1549.9919636965)
jetToElectronRatePlot.SetPointError(12, 5, 1203.0356835919)
jetToElectronRatePlot.SetPointError(13, 5, 943.3361934223)
jetToElectronRatePlot.SetPointError(14, 5, 821.9943432859)
jetToElectronRatePlot.SetPointError(15, 5, 646.8120989754)
jetToElectronRatePlot.SetPointError(16, 5, 516.4226918387)
jetToElectronRatePlot.SetPointError(17, 5, 423.0401084494)
jetToElectronRatePlot.SetPointError(18, 5, 353.6693719299)
jetToElectronRatePlot.SetPointError(19, 5, 340.0355974488)
jetToElectronRatePlot.SetPointError(20, 5, 340.381228926)
jetToElectronRatePlot.SetPointError(21, 5, 301.9190322179)
jetToElectronRatePlot.SetPointError(22, 5, 296.8310913788)
jetToElectronRatePlot.SetPointError(24, 5, 238.487289271)
jetToElectronRatePlot.SetPointError(23, 5, 227.1623661571)
jetToElectronRatePlot.SetPointError(25, 5, 225.2564431943)
jetToElectronRatePlot.SetPointError(26, 5, 210.4228797149)
jetToElectronRatePlot.SetPointError(27, 5, 193.4039697202)
jetToElectronRatePlot.SetPointError(28, 5, 200.5670797099)
jetToElectronRatePlot.SetPointError(28, 5, 194.0535426243)
jetToElectronRatePlot.SetPointError(29, 5, 186.4256048936)
jetToElectronRatePlot.SetPointError(30, 5, 192.6397917234)
jetToElectronRatePlot.SetPointError(31, 5, 183.3516865942)
jetToElectronRatePlot.SetPointError(32, 5, 189.0814268003)
jetToElectronRatePlot.SetPointError(33, 5, 178.0302029471)
jetToElectronRatePlot.SetPointError(34, 5, 165.573192688)
jetToElectronRatePlot.SetPointError(35, 5, 151.5194217987)
jetToElectronRatePlot.SetPointError(36, 5, 135.5631260271)
jetToElectronRatePlot.SetPointError(37, 5, 117.1678086847)
jetToElectronRatePlot.SetPointError(38, 5, 95.2447367388)
jetToElectronRatePlot.SetPointError(39, 5, 97.6869094757)
jetToElectronRatePlot.SetPointError(40, 5, 100.1290822125)
jetToElectronRatePlot.SetPointError(41, 5, 102.5712549494)
jetToElectronRatePlot.SetPointError(42, 5, 105.0134276863)
jetToElectronRatePlot.SetPointError(43, 5, 107.4556004232)
jetToElectronRatePlot.SetPointError(44, 5, 109.8977731601)
jetToElectronRatePlot.SetPointError(45, 5, 112.339945897)
jetToElectronRatePlot.SetPointError(46, 5, 114.7821186339)
jetToElectronRatePlot.SetPointError(47, 5, 117.2242913708)
jetToElectronRatePlot.SetPointError(48, 5, 119.6664641077)
jetToElectronRatePlot.SetPointError(49, 5, 122.1086368446)

jetToMuonRatePlot.SetPointError(0, 5, 7071067)
jetToMuonRatePlot.SetPointError(1, 5, 204684.764912908)
jetToMuonRatePlot.SetPointError(2, 5, 18607.7059011735)
jetToMuonRatePlot.SetPointError(3, 5, 17119.0894290796)
jetToMuonRatePlot.SetPointError(4, 5, 7269.1980906714)
jetToMuonRatePlot.SetPointError(5, 5, 6199.8895716)
jetToMuonRatePlot.SetPointError(6, 5, 2965.6116097503)
jetToMuonRatePlot.SetPointError(7, 5, 1966.190475483)
jetToMuonRatePlot.SetPointError(8, 5, 1398.674530226)
jetToMuonRatePlot.SetPointError(9, 5, 1035.1846909161)
jetToMuonRatePlot.SetPointError(10, 5, 783.2480550247)
jetToMuonRatePlot.SetPointError(11, 5, 647.6354690644)
jetToMuonRatePlot.SetPointError(12, 5, 499.5438684666)
jetToMuonRatePlot.SetPointError(13, 5, 388.5119540449)
jetToMuonRatePlot.SetPointError(14, 5, 336.1927140533)
jetToMuonRatePlot.SetPointError(15, 5, 261.1143854704)
jetToMuonRatePlot.SetPointError(16, 5, 205.1111947689)
jetToMuonRatePlot.SetPointError(17, 5, 164.8799177813)
jetToMuonRatePlot.SetPointError(18, 5, 134.9146890132)
jetToMuonRatePlot.SetPointError(19, 5, 128.4490461192)
jetToMuonRatePlot.SetPointError(20, 5, 127.8601707169)
jetToMuonRatePlot.SetPointError(21, 5, 111.0937508992)
jetToMuonRatePlot.SetPointError(22, 5, 108.2922075397)
jetToMuonRatePlot.SetPointError(24, 5, 83.5750779281)
jetToMuonRatePlot.SetPointError(23, 5, 78.3571049445)
jetToMuonRatePlot.SetPointError(25, 5, 77.0075622522)
jetToMuonRatePlot.SetPointError(26, 5, 70.478222958)
jetToMuonRatePlot.SetPointError(27, 5, 63.1871916288)
jetToMuonRatePlot.SetPointError(28, 5, 65.5274579854)
jetToMuonRatePlot.SetPointError(28, 5, 62.4834736401)
jetToMuonRatePlot.SetPointError(29, 5, 59.0558626477)
jetToMuonRatePlot.SetPointError(30, 5, 61.0243914026)
jetToMuonRatePlot.SetPointError(31, 5, 57.0213304834)
jetToMuonRatePlot.SetPointError(32, 5, 58.803247061)
jetToMuonRatePlot.SetPointError(33, 5, 54.2156178428)
jetToMuonRatePlot.SetPointError(34, 5, 49.2176761618)
jetToMuonRatePlot.SetPointError(35, 5, 43.7893443978)
jetToMuonRatePlot.SetPointError(36, 5, 37.8954851192)
jetToMuonRatePlot.SetPointError(37, 5, 31.4678308189)
jetToMuonRatePlot.SetPointError(38, 5, 24.3504778215)
jetToMuonRatePlot.SetPointError(39, 5, 24.9748490477)
jetToMuonRatePlot.SetPointError(40, 5, 25.5992202739)
jetToMuonRatePlot.SetPointError(41, 5, 26.2235915001)
jetToMuonRatePlot.SetPointError(42, 5, 26.8479627263)
jetToMuonRatePlot.SetPointError(43, 5, 27.4723339525)
jetToMuonRatePlot.SetPointError(44, 5, 28.0967051787)
jetToMuonRatePlot.SetPointError(45, 5, 28.7210764048)
jetToMuonRatePlot.SetPointError(46, 5, 29.345447631)
jetToMuonRatePlot.SetPointError(47, 5, 29.9698188572)
jetToMuonRatePlot.SetPointError(48, 5, 30.5941900834)
jetToMuonRatePlot.SetPointError(49, 5, 31.2185613096)

jetToMETRatePlot.SetPointError(0, 5, 7071067)
jetToMETRatePlot.SetPointError(1, 5, 54771266.8299736)
jetToMETRatePlot.SetPointError(2, 5, 15435538.8339017)
jetToMETRatePlot.SetPointError(3, 5, 9161739.17883194)
jetToMETRatePlot.SetPointError(4, 5, 2492531.45749828)
jetToMETRatePlot.SetPointError(5, 5, 592722.804252886)
jetToMETRatePlot.SetPointError(6, 5, 304389.918404508)
jetToMETRatePlot.SetPointError(7, 5, 193864.453068518)
jetToMETRatePlot.SetPointError(8, 5, 176138.35157381)
jetToMETRatePlot.SetPointError(9, 5, 120598.118554004)
jetToMETRatePlot.SetPointError(10, 5, 91404.8139791472)
jetToMETRatePlot.SetPointError(11, 5, 75712.7399760663)
jetToMETRatePlot.SetPointError(12, 5, 58571.1)
jetToMETRatePlot.SetPointError(13, 5, 45729.6887359517)
jetToMETRatePlot.SetPointError(14, 5, 39702.9313562022)
jetToMETRatePlot.SetPointError(15, 5, 31031.1312981114)
jetToMETRatePlot.SetPointError(16, 5, 24570.6384255681)
jetToMETRatePlot.SetPointError(17, 5, 19937.9229381354)
jetToMETRatePlot.SetPointError(18, 5, 16493.4649478423)
jetToMETRatePlot.SetPointError(19, 5, 15782.6588155997)
jetToMETRatePlot.SetPointError(20, 5, 15756.2132458913)
jetToMETRatePlot.SetPointError(21, 5, 13839.8109813402)
jetToMETRatePlot.SetPointError(22, 5, 13552.4915201044)
jetToMETRatePlot.SetPointError(24, 5, 10691.55)
jetToMETRatePlot.SetPointError(23, 5, 10113.1913424794)
jetToMETRatePlot.SetPointError(25, 5, 9989.4691933869)
jetToMETRatePlot.SetPointError(26, 5, 9250.4270417371)
jetToMETRatePlot.SetPointError(27, 5, 8414.812230111)
jetToMETRatePlot.SetPointError(28, 5, 8726.4719423373)
jetToMETRatePlot.SetPointError(28, 5, 8393.3077595487)
jetToMETRatePlot.SetPointError(29, 5, 8011.0798387296)
jetToMETRatePlot.SetPointError(30, 5, 8278.1158333539)
jetToMETRatePlot.SetPointError(31, 5, 7822.4773324057)
jetToMETRatePlot.SetPointError(32, 5, 8066.9297490433)
jetToMETRatePlot.SetPointError(33, 5, 7534.8764778263)
jetToMETRatePlot.SetPointError(34, 5, 6945.1487041316)
jetToMETRatePlot.SetPointError(35, 5, 6291.8095745183)
jetToMETRatePlot.SetPointError(36, 5, 5565.0616015638)
jetToMETRatePlot.SetPointError(37, 5, 4747.1379847757)
jetToMETRatePlot.SetPointError(38, 5, 3800.6679786717)
jetToMETRatePlot.SetPointError(39, 5, 3898.1210037658)
jetToMETRatePlot.SetPointError(40, 5, 3995.5740288599)
jetToMETRatePlot.SetPointError(41, 5, 4093.0270539541)
jetToMETRatePlot.SetPointError(42, 5, 4190.4800790482)
jetToMETRatePlot.SetPointError(43, 5, 4287.9331041424)
jetToMETRatePlot.SetPointError(44, 5, 4385.3861292365)
jetToMETRatePlot.SetPointError(45, 5, 4482.8391543307)
jetToMETRatePlot.SetPointError(46, 5, 4580.2921794248)
jetToMETRatePlot.SetPointError(47, 5, 4677.745204519)
jetToMETRatePlot.SetPointError(48, 5, 4775.1982296131)
jetToMETRatePlot.SetPointError(49, 5, 4872.6512547072)

ratePlot = TMultiGraph()

# Setting colours 
# Black
jetRatePlot.SetLineColor(1)
jetRatePlot.SetFillColor(1)
# Red
jetToMuonRatePlot.SetLineColor(2)
jetToMuonRatePlot.SetFillColor(2)
# Green
jetToElectronRatePlot.SetLineColor(3)
jetToElectronRatePlot.SetFillColor(3)
# Blue
jetToMETRatePlot.SetLineColor(4)
jetToMETRatePlot.SetFillColor(4)

# Adding a legend

canvas = TCanvas("c1", "canvas")
canvas.SetLogy(True)
canvas.SetGridx()
canvas.SetGridy()

leg = TLegend(0.65,0.7,0.90,0.9)
leg.SetHeader("Single object rates")
leg.AddEntry(jetRatePlot,"Jets","l")
leg.AddEntry(jetToMETRatePlot,"MET","l")
leg.AddEntry(jetToElectronRatePlot,"Electrons","l")
leg.AddEntry(jetToMuonRatePlot,"Muons","l")

## Removing stat info
#jetRatePlot.SetStats(False)
#jetToMuonRatePlot.SetStats(False)
#jetToElectronRatePlot.SetStats(False)
## jetToPhotonRatePlot.SetStats(False)
#jetToMETRatePlot.SetStats(False)

# Plotting stuff
ratePlot.Add(jetRatePlot, "A3L")
jetRatePlot.SetFillStyle(1001)
jetRatePlot.SetLineWidth(2)
jetRatePlot.SetLineStyle(1)
ratePlot.Add(jetToMuonRatePlot, "A3")
jetToMuonRatePlot.SetFillStyle(1001)
jetToMuonRatePlot.SetLineWidth(2)
jetToMuonRatePlot.SetLineStyle(1)
ratePlot.Add(jetToElectronRatePlot, "A3")
jetToElectronRatePlot.SetFillStyle(1001)
jetToElectronRatePlot.SetLineWidth(2)
jetToElectronRatePlot.SetLineStyle(1)
# ratePlot.Add(jetToPhotonRatePlot, "A3")
# jetToPhotonRatePlot.SetFillStyle(1001)
# jetToPhotonRatePlot.SetLineWidth(2)
# jetToPhotonRatePlot.SetLineStyle(1)
ratePlot.Add(jetToMETRatePlot, "A3")
jetToMETRatePlot.SetFillStyle(1001)
jetToMETRatePlot.SetLineWidth(2)
jetToMETRatePlot.SetLineStyle(1)
ratePlot.Draw("A3")

# Plot labels
ratePlot.SetTitle("Zero pile-up event rate simulation")
ratePlot.GetXaxis().SetTitle("p_{t} [GeV]")
ratePlot.GetYaxis().SetTitle("Rate [Hz]")

leg.Draw()

# Plot ranges
ratePlot.GetYaxis().SetRangeUser(1e2, 1e10)
ratePlot.GetXaxis().SetRangeUser(30, 370)

# Lumi and energy info
text = TPaveText(0.2, 0.84, 0.6, 0.9, "NDC")
text.AddText("L_{inst} = 5 #times 10^{34} cm^{-2} s^{-1}   #sqrt{s} = 100 TeV")
text.Draw()

# Adding a reference line at 1 MHz

mhzLine = TLine(30, mySettings.yScale, 160, mySettings.yScale)
mhzLine.SetLineColor(2)
mhzLine.SetLineStyle(2)
mhzLine.Draw()

label_1MHz = TLatex(143, 1.1*mySettings.yScale, "1 MHz")
label_1MHz.SetTextSize(0.04)
label_1MHz.Draw()

canvas.Update()
canvas.Draw()
canvas.Print("ratePlot.png", "png")
canvas.Print("ratePlot.svg", "svg")
canvas.Print("ratePlot.pdf", "pdf")
canvas.Print("ratePlot.C", "cxx")
