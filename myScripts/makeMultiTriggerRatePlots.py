'''
  Receives a ROOT file with trigger rates as an argument and plots them altogether
'''

from ROOT import TFile
from ROOT import TMultiGraph
from ROOT import TGraphErrors
from ROOT import TLegend
from ROOT import TCanvas
from ROOT import gStyle
from ROOT import TLine
from ROOT import TPaveText
from ROOT import TLatex

import sys

gStyle.SetOptStat(0)

mySettings = lambda a: None
'''Pile up level for that kind of event'''
mySettings.pileup = 180 # FCC
#mySettings.pileup = 40 # LHC
mySettings.yScale = 1e6
'''Cross section of the event in mb'''
mySettings.crossSection = 100 # FCC
#mySettings.crossSection = 60 # LHC
'''Instantaneous lumi in cm^-2 s^-1'''
mySettings.instantaneousLuminosity = 5e34 # FCC
#mySettings.instantaneousLuminosity = 1.15e34 # LHC

# Opening TFile

triggerRatesFile = TFile(sys.argv[1])

# Loading histograms
jetRatePlot_Histo = triggerRatesFile.Get("jetTriggerRate")
jetRatePlot = TGraphErrors(jetRatePlot_Histo)
jetToMuonRatePlot_Histo = triggerRatesFile.Get("jetToMuonTriggerRate")
jetToMuonRatePlot = TGraphErrors(jetToMuonRatePlot_Histo)
jetToElectronRatePlot_Histo = triggerRatesFile.Get("jetToElectronTriggerRate")
jetToElectronRatePlot = TGraphErrors(jetToElectronRatePlot_Histo)
# jetToPhotonRatePlot_Histo = triggerRatesFile.Get("photonTriggerRate")
# jetToPhotonRatePlot = TGraphErrors(#_Histo)
jetToMETRatePlot_Histo = triggerRatesFile.Get("jetToMETTriggerRate")
jetToMETRatePlot = TGraphErrors(jetToMETRatePlot_Histo)

# Setting up error bars

jetRatePlot.SetPointError(0, 5, 7071067.81186548)
jetRatePlot.SetPointError(1, 5, 1702321.99069389)
jetRatePlot.SetPointError(2, 5, 1702321.99069389)
jetRatePlot.SetPointError(3, 5, 1702321.99069389)
jetRatePlot.SetPointError(4, 5, 1074011.17312624)
jetRatePlot.SetPointError(5, 5, 724292.758489273)
jetRatePlot.SetPointError(6, 5, 518844.870842914)
jetRatePlot.SetPointError(7, 5, 391024.295920343)
jetRatePlot.SetPointError(8, 5, 308382.878902185)
jetRatePlot.SetPointError(9, 5, 250000)
jetRatePlot.SetPointError(10, 5, 206155.281280883)
jetRatePlot.SetPointError(11, 5, 178605.710994917)
jetRatePlot.SetPointError(12, 5, 150000)
jetRatePlot.SetPointError(13, 5, 126885.775404495)
jetRatePlot.SetPointError(14, 5, 113578.166916005)
jetRatePlot.SetPointError(15, 5, 96436.5076099296)
jetRatePlot.SetPointError(16, 5, 82462.1125123532)
jetRatePlot.SetPointError(17, 5, 71414.2842854285)
jetRatePlot.SetPointError(18, 5, 62449.979983984)
jetRatePlot.SetPointError(19, 5, 59160.7978309962)
jetRatePlot.SetPointError(20, 5, 57445.6264653803)
jetRatePlot.SetPointError(21, 5, 51961.5242270663)
jetRatePlot.SetPointError(22, 5, 50000)
jetRatePlot.SetPointError(24, 5, 42426.4068711929)
jetRatePlot.SetPointError(23, 5, 40000)
jetRatePlot.SetPointError(25, 5, 38729.8334620742)
jetRatePlot.SetPointError(26, 5, 36055.5127546399)
jetRatePlot.SetPointError(27, 5, 33166.247903554)
jetRatePlot.SetPointError(28, 5, 33166.247903554)
jetRatePlot.SetPointError(28, 5, 31622.7766016838)
jetRatePlot.SetPointError(29, 5, 30000)
jetRatePlot.SetPointError(30, 5, 30000)
jetRatePlot.SetPointError(31, 5, 28284.2712474619)
jetRatePlot.SetPointError(32, 5, 28284.2712474619)
jetRatePlot.SetPointError(33, 5, 26457.5131106459)
jetRatePlot.SetPointError(34, 5, 24494.8974278318)
jetRatePlot.SetPointError(35, 5, 22360.6797749979)
jetRatePlot.SetPointError(36, 5, 20000)
jetRatePlot.SetPointError(37, 5, 17320.5080756888)
jetRatePlot.SetPointError(38, 5, 14142.135623731)
jetRatePlot.SetPointError(39, 5, 14142.135623731)
jetRatePlot.SetPointError(40, 5, 14142.135623731)
jetRatePlot.SetPointError(41, 5, 14142.135623731)
jetRatePlot.SetPointError(42, 5, 14142.135623731)
jetRatePlot.SetPointError(43, 5, 14142.135623731)
jetRatePlot.SetPointError(44, 5, 14142.135623731)
jetRatePlot.SetPointError(45, 5, 14142.135623731)
jetRatePlot.SetPointError(46, 5, 14142.135623731)
jetRatePlot.SetPointError(47, 5, 14142.135623731)
jetRatePlot.SetPointError(48, 5, 14142.135623731)
jetRatePlot.SetPointError(49, 5, 14142.135623731)

jetToElectronRatePlot.SetPointError(0, 5, 7071067)
jetToElectronRatePlot.SetPointError(1, 5, 620805.915259667)
jetToElectronRatePlot.SetPointError(2, 5, 52380.4991000344)
jetToElectronRatePlot.SetPointError(3, 5, 37927.3613853953)
jetToElectronRatePlot.SetPointError(4, 5, 18951.9795194932)
jetToElectronRatePlot.SetPointError(5, 5, 11551.8825943873)
jetToElectronRatePlot.SetPointError(6, 5, 7001.6320954982)
jetToElectronRatePlot.SetPointError(7, 5, 4648.6673491476)
jetToElectronRatePlot.SetPointError(8, 5, 3313.4742578006)
jetToElectronRatePlot.SetPointError(9, 5, 2459.0488916183)
jetToElectronRatePlot.SetPointError(10, 5, 1867.4696307753)
jetToElectronRatePlot.SetPointError(11, 5, 1549.9919636965)
jetToElectronRatePlot.SetPointError(12, 5, 1203.0356835919)
jetToElectronRatePlot.SetPointError(13, 5, 943.3361934223)
jetToElectronRatePlot.SetPointError(14, 5, 821.9943432859)
jetToElectronRatePlot.SetPointError(15, 5, 96436.5076099296)
jetToElectronRatePlot.SetPointError(16, 5, 82462.1125123532)
jetToElectronRatePlot.SetPointError(17, 5, 71414.2842854285)
jetToElectronRatePlot.SetPointError(18, 5, 62449.979983984)
jetToElectronRatePlot.SetPointError(19, 5, 59160.7978309962)
jetToElectronRatePlot.SetPointError(20, 5, 57445.6264653803)
jetToElectronRatePlot.SetPointError(21, 5, 51961.5242270663)
jetToElectronRatePlot.SetPointError(22, 5, 50000)
jetToElectronRatePlot.SetPointError(24, 5, 42426.4068711929)
jetToElectronRatePlot.SetPointError(23, 5, 40000)
jetToElectronRatePlot.SetPointError(25, 5, 38729.8334620742)
jetToElectronRatePlot.SetPointError(26, 5, 36055.5127546399)
jetToElectronRatePlot.SetPointError(27, 5, 33166.247903554)
jetToElectronRatePlot.SetPointError(28, 5, 33166.247903554)
jetToElectronRatePlot.SetPointError(28, 5, 31622.7766016838)
jetToElectronRatePlot.SetPointError(29, 5, 30000)
jetToElectronRatePlot.SetPointError(30, 5, 30000)
jetToElectronRatePlot.SetPointError(31, 5, 28284.2712474619)
jetToElectronRatePlot.SetPointError(32, 5, 28284.2712474619)
jetToElectronRatePlot.SetPointError(33, 5, 26457.5131106459)
jetToElectronRatePlot.SetPointError(34, 5, 24494.8974278318)
jetToElectronRatePlot.SetPointError(35, 5, 22360.6797749979)
jetToElectronRatePlot.SetPointError(36, 5, 20000)
jetToElectronRatePlot.SetPointError(37, 5, 17320.5080756888)
jetToElectronRatePlot.SetPointError(38, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(39, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(40, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(41, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(42, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(43, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(44, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(45, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(46, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(47, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(48, 5, 14142.135623731)
jetToElectronRatePlot.SetPointError(49, 5, 14142.135623731)

jetToMuonRatePlot.SetPointError(0, 5, 7071067)
jetToMuonRatePlot.SetPointError(1, 5, 204684.764912908)
jetToMuonRatePlot.SetPointError(2, 5, 18607.7059011735)
jetToMuonRatePlot.SetPointError(3, 5, 17119.0894290796)
jetToMuonRatePlot.SetPointError(4, 5, 7269.1980906714)
jetToMuonRatePlot.SetPointError(5, 5, 6199.8895716)
jetToMuonRatePlot.SetPointError(6, 5, 2965.6116097503)
jetToMuonRatePlot.SetPointError(7, 5, 1966.190475483)
jetToMuonRatePlot.SetPointError(8, 5, 1398.674530226)
jetToMuonRatePlot.SetPointError(9, 5, 1035.1846909161)
jetToMuonRatePlot.SetPointError(10, 5, 783.2480550247)
jetToMuonRatePlot.SetPointError(11, 5, 647.6354690644)
jetToMuonRatePlot.SetPointError(12, 5, 499.5438684666)
jetToMuonRatePlot.SetPointError(13, 5, 388.5119540449)
jetToMuonRatePlot.SetPointError(14, 5, 336.1927140533)
jetToMuonRatePlot.SetPointError(15, 5, 96436.5076099296)
jetToMuonRatePlot.SetPointError(16, 5, 82462.1125123532)
jetToMuonRatePlot.SetPointError(17, 5, 71414.2842854285)
jetToMuonRatePlot.SetPointError(18, 5, 62449.979983984)
jetToMuonRatePlot.SetPointError(19, 5, 59160.7978309962)
jetToMuonRatePlot.SetPointError(20, 5, 57445.6264653803)
jetToMuonRatePlot.SetPointError(21, 5, 51961.5242270663)
jetToMuonRatePlot.SetPointError(22, 5, 50000)
jetToMuonRatePlot.SetPointError(24, 5, 42426.4068711929)
jetToMuonRatePlot.SetPointError(23, 5, 40000)
jetToMuonRatePlot.SetPointError(25, 5, 38729.8334620742)
jetToMuonRatePlot.SetPointError(26, 5, 36055.5127546399)
jetToMuonRatePlot.SetPointError(27, 5, 33166.247903554)
jetToMuonRatePlot.SetPointError(28, 5, 33166.247903554)
jetToMuonRatePlot.SetPointError(28, 5, 31622.7766016838)
jetToMuonRatePlot.SetPointError(29, 5, 30000)
jetToMuonRatePlot.SetPointError(30, 5, 30000)
jetToMuonRatePlot.SetPointError(31, 5, 28284.2712474619)
jetToMuonRatePlot.SetPointError(32, 5, 28284.2712474619)
jetToMuonRatePlot.SetPointError(33, 5, 26457.5131106459)
jetToMuonRatePlot.SetPointError(34, 5, 24494.8974278318)
jetToMuonRatePlot.SetPointError(35, 5, 22360.6797749979)
jetToMuonRatePlot.SetPointError(36, 5, 20000)
jetToMuonRatePlot.SetPointError(37, 5, 17320.5080756888)
jetToMuonRatePlot.SetPointError(38, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(39, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(40, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(41, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(42, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(43, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(44, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(45, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(46, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(47, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(48, 5, 14142.135623731)
jetToMuonRatePlot.SetPointError(49, 5, 14142.135623731)

jetToMETRatePlot.SetPointError(0, 5, 7071067)
jetToMETRatePlot.SetPointError(1, 5, 54771266.8299736)
jetToMETRatePlot.SetPointError(2, 5, 15435538.8339017)
jetToMETRatePlot.SetPointError(3, 5, 9161739.17883194)
jetToMETRatePlot.SetPointError(4, 5, 2492531.45749828)
jetToMETRatePlot.SetPointError(5, 5, 592722.804252886)
jetToMETRatePlot.SetPointError(6, 5, 304389.918404508)
jetToMETRatePlot.SetPointError(7, 5, 193864.453068518)
jetToMETRatePlot.SetPointError(8, 5, 176138.35157381)
jetToMETRatePlot.SetPointError(9, 5, 120598.118554004)
jetToMETRatePlot.SetPointError(10, 5, 91404.8139791472)
jetToMETRatePlot.SetPointError(11, 5, 75712.7399760663)
jetToMETRatePlot.SetPointError(12, 5, 58571.1)
jetToMETRatePlot.SetPointError(13, 5, 45729.6887359517)
jetToMETRatePlot.SetPointError(14, 5, 39702.9313562022)
jetToMETRatePlot.SetPointError(15, 5, 96436.5076099296)
jetToMETRatePlot.SetPointError(16, 5, 82462.1125123532)
jetToMETRatePlot.SetPointError(17, 5, 71414.2842854285)
jetToMETRatePlot.SetPointError(18, 5, 62449.979983984)
jetToMETRatePlot.SetPointError(19, 5, 59160.7978309962)
jetToMETRatePlot.SetPointError(20, 5, 57445.6264653803)
jetToMETRatePlot.SetPointError(21, 5, 51961.5242270663)
jetToMETRatePlot.SetPointError(22, 5, 50000)
jetToMETRatePlot.SetPointError(24, 5, 42426.4068711929)
jetToMETRatePlot.SetPointError(23, 5, 40000)
jetToMETRatePlot.SetPointError(25, 5, 38729.8334620742)
jetToMETRatePlot.SetPointError(26, 5, 36055.5127546399)
jetToMETRatePlot.SetPointError(27, 5, 33166.247903554)
jetToMETRatePlot.SetPointError(28, 5, 33166.247903554)
jetToMETRatePlot.SetPointError(28, 5, 31622.7766016838)
jetToMETRatePlot.SetPointError(29, 5, 30000)
jetToMETRatePlot.SetPointError(30, 5, 30000)
jetToMETRatePlot.SetPointError(31, 5, 28284.2712474619)
jetToMETRatePlot.SetPointError(32, 5, 28284.2712474619)
jetToMETRatePlot.SetPointError(33, 5, 26457.5131106459)
jetToMETRatePlot.SetPointError(34, 5, 24494.8974278318)
jetToMETRatePlot.SetPointError(35, 5, 22360.6797749979)
jetToMETRatePlot.SetPointError(36, 5, 20000)
jetToMETRatePlot.SetPointError(37, 5, 17320.5080756888)
jetToMETRatePlot.SetPointError(38, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(39, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(40, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(41, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(42, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(43, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(44, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(45, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(46, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(47, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(48, 5, 14142.135623731)
jetToMETRatePlot.SetPointError(49, 5, 14142.135623731)

ratePlot = TMultiGraph()

# Setting colours 
# Black
jetRatePlot.SetLineColor(1)
jetRatePlot.SetFillColor(1)
# Red
jetToMuonRatePlot.SetLineColor(2)
jetToMuonRatePlot.SetFillColor(2)
# Green
jetToElectronRatePlot.SetLineColor(3)
jetToElectronRatePlot.SetFillColor(3)
# Blue
jetToMETRatePlot.SetLineColor(4)
jetToMETRatePlot.SetFillColor(4)

# Adding a legend

canvas = TCanvas("c1", "canvas")
canvas.SetLogy(True)
canvas.SetGridx()
canvas.SetGridy()

leg = TLegend(0.65,0.7,0.90,0.9)
leg.SetHeader("Single object rates")
leg.AddEntry(jetRatePlot,"Jets","l")
leg.AddEntry(jetToMETRatePlot,"MET","l")
leg.AddEntry(jetToElectronRatePlot,"Electrons","l")
leg.AddEntry(jetToMuonRatePlot,"Muons","l")

## Removing stat info
#jetRatePlot.SetStats(False)
#jetToMuonRatePlot.SetStats(False)
#jetToElectronRatePlot.SetStats(False)
## jetToPhotonRatePlot.SetStats(False)
#jetToMETRatePlot.SetStats(False)

# Plotting stuff
ratePlot.Add(jetRatePlot, "A3L")
jetRatePlot.SetFillStyle(1001)
jetRatePlot.SetLineWidth(2)
jetRatePlot.SetLineStyle(1)
ratePlot.Add(jetToMuonRatePlot, "A3")
jetToMuonRatePlot.SetFillStyle(1001)
jetToMuonRatePlot.SetLineWidth(2)
jetToMuonRatePlot.SetLineStyle(1)
ratePlot.Add(jetToElectronRatePlot, "A3")
jetToElectronRatePlot.SetFillStyle(1001)
jetToElectronRatePlot.SetLineWidth(2)
jetToElectronRatePlot.SetLineStyle(1)
# ratePlot.Add(jetToPhotonRatePlot, "A3")
# jetToPhotonRatePlot.SetFillStyle(1001)
# jetToPhotonRatePlot.SetLineWidth(2)
# jetToPhotonRatePlot.SetLineStyle(1)
ratePlot.Add(jetToMETRatePlot, "A3")
jetToMETRatePlot.SetFillStyle(1001)
jetToMETRatePlot.SetLineWidth(2)
jetToMETRatePlot.SetLineStyle(1)
ratePlot.Draw("A3")

# Plot labels
ratePlot.SetTitle("Zero pile-up event rate simulation")
ratePlot.GetXaxis().SetTitle("p_{t} [GeV]")
ratePlot.GetYaxis().SetTitle("Rate [Hz]")

leg.Draw()

# Plot ranges
ratePlot.GetYaxis().SetRangeUser(1e2, 1e10)
ratePlot.GetXaxis().SetRangeUser(30, 370)

# Lumi and energy info
text = TPaveText(0.2, 0.84, 0.6, 0.9, "NDC")
text.AddText("L_{inst} = 5 #times 10^{34} cm^{-2} s^{-1}   #sqrt{s} = 100 TeV")
text.Draw()

# Adding a reference line at 1 MHz

mhzLine = TLine(30, mySettings.yScale, 160, mySettings.yScale)
mhzLine.SetLineColor(2)
mhzLine.SetLineStyle(2)
mhzLine.Draw()

label_1MHz = TLatex(143, 1.1*mySettings.yScale, "1 MHz")
label_1MHz.SetTextSize(0.04)
label_1MHz.Draw()

canvas.Update()
canvas.Draw()
canvas.Print("ratePlot.png", "png")
canvas.Print("ratePlot.svg", "svg")
canvas.Print("ratePlot.pdf", "pdf")
canvas.Print("ratePlot.C", "cxx")
