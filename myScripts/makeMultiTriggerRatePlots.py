'''
  Receives a ROOT file with trigger rates as an argument and plots them altogether
'''

from ROOT import TFile
from ROOT import TMultiGraph
from ROOT import TGraphErrors
from ROOT import TLegend
from ROOT import TCanvas
from ROOT import gStyle
from ROOT import TLine
from ROOT import TPaveText
from ROOT import TLatex

import sys

gStyle.SetOptStat(0)

mySettings = lambda a: None
'''Pile up level for that kind of event'''
mySettings.pileup = 180 # FCC
#mySettings.pileup = 40 # LHC
mySettings.yScale = 1e6
'''Cross section of the event in mb'''
mySettings.crossSection = 100 # FCC
#mySettings.crossSection = 60 # LHC
'''Instantaneous lumi in cm^-2 s^-1'''
mySettings.instantaneousLuminosity = 3e35 # FCC
#mySettings.instantaneousLuminosity = 1.15e34 # LHC

# Opening TFile

triggerRatesFile = TFile(sys.argv[1])

# Loading histograms
jetRatePlot_Histo = triggerRatesFile.Get("jetTriggerRate")
jetRatePlot = TGraphErrors(jetRatePlot_Histo)
jetToMuonRatePlot_Histo = triggerRatesFile.Get("jetToMuonTriggerRate")
jetToMuonRatePlot = TGraphErrors(jetToMuonRatePlot_Histo)
jetToElectronRatePlot_Histo = triggerRatesFile.Get("jetToElectronTriggerRate")
jetToElectronRatePlot = TGraphErrors(jetToElectronRatePlot_Histo)
# jetToPhotonRatePlot_Histo = triggerRatesFile.Get("photonTriggerRate")
# jetToPhotonRatePlot = TGraphErrors(#_Histo)
jetToMETRatePlot_Histo = triggerRatesFile.Get("jetToMETTriggerRate")
jetToMETRatePlot = TGraphErrors(jetToMETRatePlot_Histo)

# Setting up error bars

jetRatePlot.SetPointError(0, 5, 7071067.81186548)
jetRatePlot.SetPointError(1, 5, 10213931.9441633)
jetRatePlot.SetPointError(2, 5, 10213931.9441633)
jetRatePlot.SetPointError(3, 5, 10213931.9441633)
jetRatePlot.SetPointError(4, 5, 6444067.03875743)
jetRatePlot.SetPointError(5, 5, 4345756.55093564)
jetRatePlot.SetPointError(6, 5, 3113069.22505748)
jetRatePlot.SetPointError(7, 5, 2346145.77552206)
jetRatePlot.SetPointError(8, 5, 1850297.27341311)
jetRatePlot.SetPointError(9, 5, 1500000)
jetRatePlot.SetPointError(10, 5, 1236931.6876853)
jetRatePlot.SetPointError(11, 5, 1071634.26596951)
jetRatePlot.SetPointError(12, 5, 900000)
jetRatePlot.SetPointError(13, 5, 761314.652426971)
jetRatePlot.SetPointError(14, 5, 681469.001496033)
jetRatePlot.SetPointError(15, 5, 578619.045659577)
jetRatePlot.SetPointError(16, 5, 494772.675074119)
jetRatePlot.SetPointError(17, 5, 428485.705712571)
jetRatePlot.SetPointError(18, 5, 374699.879903904)
jetRatePlot.SetPointError(19, 5, 354964.786985977)
jetRatePlot.SetPointError(20, 5, 344673.758792282)
jetRatePlot.SetPointError(21, 5, 311769.145362398)
jetRatePlot.SetPointError(22, 5, 300000)
jetRatePlot.SetPointError(24, 5, 254558.441227157)
jetRatePlot.SetPointError(23, 5, 240000)
jetRatePlot.SetPointError(25, 5, 232379.000772445)
jetRatePlot.SetPointError(26, 5, 216333.076527839)
jetRatePlot.SetPointError(27, 5, 198997.487421324)
jetRatePlot.SetPointError(28, 5, 198997.487421324)
jetRatePlot.SetPointError(28, 5, 189736.659610103)
jetRatePlot.SetPointError(29, 5, 180000)
jetRatePlot.SetPointError(30, 5, 180000)
jetRatePlot.SetPointError(31, 5, 169705.627484771)
jetRatePlot.SetPointError(32, 5, 169705.627484771)
jetRatePlot.SetPointError(33, 5, 158745.078663875)
jetRatePlot.SetPointError(34, 5, 146969.384566991)
jetRatePlot.SetPointError(35, 5, 134164.078649987)
jetRatePlot.SetPointError(36, 5, 120000)
jetRatePlot.SetPointError(37, 5, 103923.048454133)
jetRatePlot.SetPointError(38, 5, 84852.8137423857)
jetRatePlot.SetPointError(39, 5, 84852.8137423857)
jetRatePlot.SetPointError(40, 5, 84852.8137423857)
jetRatePlot.SetPointError(41, 5, 84852.8137423857)
jetRatePlot.SetPointError(42, 5, 84852.8137423857)
jetRatePlot.SetPointError(43, 5, 84852.8137423857)
jetRatePlot.SetPointError(44, 5, 84852.8137423857)
jetRatePlot.SetPointError(45, 5, 84852.8137423857)
jetRatePlot.SetPointError(46, 5, 84852.8137423857)
jetRatePlot.SetPointError(47, 5, 84852.8137423857)
jetRatePlot.SetPointError(48, 5, 84852.8137423857)
jetRatePlot.SetPointError(49, 5, 84852.8137423857)

jetToElectronRatePlot.SetPointError(0, 5, 7071067)
jetToElectronRatePlot.SetPointError(1, 5, 3724835.491558)
jetToElectronRatePlot.SetPointError(2, 5, 314282.994600205)
jetToElectronRatePlot.SetPointError(3, 5, 227564.168312372)
jetToElectronRatePlot.SetPointError(4, 5, 113711.877116959)
jetToElectronRatePlot.SetPointError(5, 5, 69311.295566324)
jetToElectronRatePlot.SetPointError(6, 5, 42009.7925729893)
jetToElectronRatePlot.SetPointError(7, 5, 27892.0040948856)
jetToElectronRatePlot.SetPointError(8, 5, 19880.8455468035)
jetToElectronRatePlot.SetPointError(9, 5, 14754.2933497095)
jetToElectronRatePlot.SetPointError(10, 5, 11204.8177846516)
jetToElectronRatePlot.SetPointError(11, 5, 9299.9517821792)
jetToElectronRatePlot.SetPointError(12, 5, 7218.2141015513)
jetToElectronRatePlot.SetPointError(13, 5, 5660.017160534)
jetToElectronRatePlot.SetPointError(14, 5, 4931.9660597156)
jetToElectronRatePlot.SetPointError(15, 5, 3880.8725938526)
jetToElectronRatePlot.SetPointError(16, 5, 3098.5361510322)
jetToElectronRatePlot.SetPointError(17, 5, 2538.2406506962)
jetToElectronRatePlot.SetPointError(18, 5, 2122.0162315794)
jetToElectronRatePlot.SetPointError(19, 5, 2040.213584693)
jetToElectronRatePlot.SetPointError(20, 5, 2042.2873735559)
jetToElectronRatePlot.SetPointError(21, 5, 1811.5141933074)
jetToElectronRatePlot.SetPointError(22, 5, 1780.9865482729)
jetToElectronRatePlot.SetPointError(24, 5, 1430.9237356262)
jetToElectronRatePlot.SetPointError(23, 5, 1362.9741969428)
jetToElectronRatePlot.SetPointError(25, 5, 1351.5386591656)
jetToElectronRatePlot.SetPointError(26, 5, 1262.5372782895)
jetToElectronRatePlot.SetPointError(27, 5, 1160.4238183214)
jetToElectronRatePlot.SetPointError(28, 5, 1203.4024782592)
jetToElectronRatePlot.SetPointError(28, 5, 1164.3212557457)
jetToElectronRatePlot.SetPointError(29, 5, 1118.5536293618)
jetToElectronRatePlot.SetPointError(30, 5, 1155.8387503405)
jetToElectronRatePlot.SetPointError(31, 5, 1100.1101195652)
jetToElectronRatePlot.SetPointError(32, 5, 1134.4885608016)
jetToElectronRatePlot.SetPointError(33, 5, 1068.1812176825)
jetToElectronRatePlot.SetPointError(34, 5, 993.4391561278)
jetToElectronRatePlot.SetPointError(35, 5, 909.116530792)
jetToElectronRatePlot.SetPointError(36, 5, 813.3787561626)
jetToElectronRatePlot.SetPointError(37, 5, 703.0068521081)
jetToElectronRatePlot.SetPointError(38, 5, 571.4684204326)
jetToElectronRatePlot.SetPointError(39, 5, 586.1214568539)
jetToElectronRatePlot.SetPointError(40, 5, 600.7744932753)
jetToElectronRatePlot.SetPointError(41, 5, 615.4275296966)
jetToElectronRatePlot.SetPointError(42, 5, 630.080566118)
jetToElectronRatePlot.SetPointError(43, 5, 644.7336025393)
jetToElectronRatePlot.SetPointError(44, 5, 659.3866389606)
jetToElectronRatePlot.SetPointError(45, 5, 674.039675382)
jetToElectronRatePlot.SetPointError(46, 5, 688.6927118033)
jetToElectronRatePlot.SetPointError(47, 5, 703.3457482247)
jetToElectronRatePlot.SetPointError(48, 5, 717.998784646)
jetToElectronRatePlot.SetPointError(49, 5, 732.6518210674)

jetToMuonRatePlot.SetPointError(0, 5, 7071067)
jetToMuonRatePlot.SetPointError(1, 5, 1228108.58947745)
jetToMuonRatePlot.SetPointError(2, 5, 111646.235407041)
jetToMuonRatePlot.SetPointError(3, 5, 102714.536574478)
jetToMuonRatePlot.SetPointError(4, 5, 43615.1885440286)
jetToMuonRatePlot.SetPointError(5, 5, 37199.3374296001)
jetToMuonRatePlot.SetPointError(6, 5, 17793.6696585016)
jetToMuonRatePlot.SetPointError(7, 5, 11797.1428528981)
jetToMuonRatePlot.SetPointError(8, 5, 8392.0471813559)
jetToMuonRatePlot.SetPointError(9, 5, 6211.1081454965)
jetToMuonRatePlot.SetPointError(10, 5, 4699.4883301483)
jetToMuonRatePlot.SetPointError(11, 5, 3885.8128143865)
jetToMuonRatePlot.SetPointError(12, 5, 2997.2632107996)
jetToMuonRatePlot.SetPointError(13, 5, 2331.0717242693)
jetToMuonRatePlot.SetPointError(14, 5, 2017.1562843195)
jetToMuonRatePlot.SetPointError(15, 5, 1566.6863128221)
jetToMuonRatePlot.SetPointError(16, 5, 1230.6671686133)
jetToMuonRatePlot.SetPointError(17, 5, 989.2795066876)
jetToMuonRatePlot.SetPointError(18, 5, 809.4881340791)
jetToMuonRatePlot.SetPointError(19, 5, 770.6942767153)
jetToMuonRatePlot.SetPointError(20, 5, 767.1610243013)
jetToMuonRatePlot.SetPointError(21, 5, 666.5625053954)
jetToMuonRatePlot.SetPointError(22, 5, 649.7532452384)
jetToMuonRatePlot.SetPointError(24, 5, 501.4504675684)
jetToMuonRatePlot.SetPointError(23, 5, 470.142629667)
jetToMuonRatePlot.SetPointError(25, 5, 462.0453735134)
jetToMuonRatePlot.SetPointError(26, 5, 422.8693377479)
jetToMuonRatePlot.SetPointError(27, 5, 379.1231497726)
jetToMuonRatePlot.SetPointError(28, 5, 393.1647479123)
jetToMuonRatePlot.SetPointError(28, 5, 374.9008418408)
jetToMuonRatePlot.SetPointError(29, 5, 354.3351758863)
jetToMuonRatePlot.SetPointError(30, 5, 366.1463484158)
jetToMuonRatePlot.SetPointError(31, 5, 342.1279829005)
jetToMuonRatePlot.SetPointError(32, 5, 352.8194823662)
jetToMuonRatePlot.SetPointError(33, 5, 325.293707057)
jetToMuonRatePlot.SetPointError(34, 5, 295.3060569708)
jetToMuonRatePlot.SetPointError(35, 5, 262.7360663865)
jetToMuonRatePlot.SetPointError(36, 5, 227.3729107151)
jetToMuonRatePlot.SetPointError(37, 5, 188.8069849134)
jetToMuonRatePlot.SetPointError(38, 5, 146.102866929)
jetToMuonRatePlot.SetPointError(39, 5, 149.8490942862)
jetToMuonRatePlot.SetPointError(40, 5, 153.5953216433)
jetToMuonRatePlot.SetPointError(41, 5, 157.3415490005)
jetToMuonRatePlot.SetPointError(42, 5, 161.0877763576)
jetToMuonRatePlot.SetPointError(43, 5, 164.8340037148)
jetToMuonRatePlot.SetPointError(44, 5, 168.5802310719)
jetToMuonRatePlot.SetPointError(45, 5, 172.3264584291)
jetToMuonRatePlot.SetPointError(46, 5, 176.0726857862)
jetToMuonRatePlot.SetPointError(47, 5, 179.8189131434)
jetToMuonRatePlot.SetPointError(48, 5, 183.5651405005)
jetToMuonRatePlot.SetPointError(49, 5, 187.3113678577)

jetToMETRatePlot.SetPointError(0, 5, 7071067)
jetToMETRatePlot.SetPointError(1, 5, 328627600.979841)
jetToMETRatePlot.SetPointError(2, 5, 92613233.0034101)
jetToMETRatePlot.SetPointError(3, 5, 54970435.0729918)
jetToMETRatePlot.SetPointError(4, 5, 14955188.7449897)
jetToMETRatePlot.SetPointError(5, 5, 3556336.82551732)
jetToMETRatePlot.SetPointError(6, 5, 1826339.51042706)
jetToMETRatePlot.SetPointError(7, 5, 1163186.71841111)
jetToMETRatePlot.SetPointError(8, 5, 1056830.10944286)
jetToMETRatePlot.SetPointError(9, 5, 723588.711324025)
jetToMETRatePlot.SetPointError(10, 5, 548428.883874885)
jetToMETRatePlot.SetPointError(11, 5, 454276.439856399)
jetToMETRatePlot.SetPointError(12, 5, 351426.6)
jetToMETRatePlot.SetPointError(13, 5, 274378.13241571)
jetToMETRatePlot.SetPointError(14, 5, 238217.588137214)
jetToMETRatePlot.SetPointError(15, 5, 186186.787788668)
jetToMETRatePlot.SetPointError(16, 5, 147423.830553408)
jetToMETRatePlot.SetPointError(17, 5, 119627.537628812)
jetToMETRatePlot.SetPointError(18, 5, 98960.7896870536)
jetToMETRatePlot.SetPointError(19, 5, 94695.952893598)
jetToMETRatePlot.SetPointError(20, 5, 94537.2794753478)
jetToMETRatePlot.SetPointError(21, 5, 83038.8658880413)
jetToMETRatePlot.SetPointError(22, 5, 81314.9491206262)
jetToMETRatePlot.SetPointError(24, 5, 64149.3000000001)
jetToMETRatePlot.SetPointError(23, 5, 60679.1480548764)
jetToMETRatePlot.SetPointError(25, 5, 59936.8151603212)
jetToMETRatePlot.SetPointError(26, 5, 55502.5622504224)
jetToMETRatePlot.SetPointError(27, 5, 50488.8733806658)
jetToMETRatePlot.SetPointError(28, 5, 52358.8316540238)
jetToMETRatePlot.SetPointError(28, 5, 50359.8465572921)
jetToMETRatePlot.SetPointError(29, 5, 48066.4790323777)
jetToMETRatePlot.SetPointError(30, 5, 49668.6950001236)
jetToMETRatePlot.SetPointError(31, 5, 46934.8639944339)
jetToMETRatePlot.SetPointError(32, 5, 48401.5784942599)
jetToMETRatePlot.SetPointError(33, 5, 45209.2588669578)
jetToMETRatePlot.SetPointError(34, 5, 41670.8922247893)
jetToMETRatePlot.SetPointError(35, 5, 37750.8574471097)
jetToMETRatePlot.SetPointError(36, 5, 33390.3696093829)
jetToMETRatePlot.SetPointError(37, 5, 28482.827908654)
jetToMETRatePlot.SetPointError(38, 5, 22804.0078720299)
jetToMETRatePlot.SetPointError(39, 5, 23388.7260225947)
jetToMETRatePlot.SetPointError(40, 5, 23973.4441731596)
jetToMETRatePlot.SetPointError(41, 5, 24558.1623237245)
jetToMETRatePlot.SetPointError(42, 5, 25142.8804742893)
jetToMETRatePlot.SetPointError(43, 5, 25727.5986248542)
jetToMETRatePlot.SetPointError(44, 5, 26312.3167754191)
jetToMETRatePlot.SetPointError(45, 5, 26897.034925984)
jetToMETRatePlot.SetPointError(46, 5, 27481.7530765488)
jetToMETRatePlot.SetPointError(47, 5, 28066.4712271137)
jetToMETRatePlot.SetPointError(48, 5, 28651.1893776786)
jetToMETRatePlot.SetPointError(49, 5, 29235.9075282434)

ratePlot = TMultiGraph()

# Setting colours 
# Black
jetRatePlot.SetLineColor(1)
jetRatePlot.SetFillColor(1)
# Red
jetToMuonRatePlot.SetLineColor(2)
jetToMuonRatePlot.SetFillColor(2)
# Green
jetToElectronRatePlot.SetLineColor(3)
jetToElectronRatePlot.SetFillColor(3)
# Blue
jetToMETRatePlot.SetLineColor(4)
jetToMETRatePlot.SetFillColor(4)

# Adding a legend

canvas = TCanvas("c1", "canvas")
canvas.SetLogy(True)
canvas.SetGridx()
canvas.SetGridy()

leg = TLegend(0.65,0.7,0.90,0.9)
leg.SetHeader("Single object rates")
leg.AddEntry(jetRatePlot,"Jets","l")
leg.AddEntry(jetToMETRatePlot,"MET","l")
leg.AddEntry(jetToElectronRatePlot,"Electrons","l")
leg.AddEntry(jetToMuonRatePlot,"Muons","l")

## Removing stat info
#jetRatePlot.SetStats(False)
#jetToMuonRatePlot.SetStats(False)
#jetToElectronRatePlot.SetStats(False)
## jetToPhotonRatePlot.SetStats(False)
#jetToMETRatePlot.SetStats(False)

# Plotting stuff
ratePlot.Add(jetRatePlot, "A3L")
jetRatePlot.SetFillStyle(1001)
jetRatePlot.SetLineWidth(2)
jetRatePlot.SetLineStyle(1)
ratePlot.Add(jetToMuonRatePlot, "A3")
jetToMuonRatePlot.SetFillStyle(1001)
jetToMuonRatePlot.SetLineWidth(2)
jetToMuonRatePlot.SetLineStyle(1)
ratePlot.Add(jetToElectronRatePlot, "A3")
jetToElectronRatePlot.SetFillStyle(1001)
jetToElectronRatePlot.SetLineWidth(2)
jetToElectronRatePlot.SetLineStyle(1)
# ratePlot.Add(jetToPhotonRatePlot, "A3")
# jetToPhotonRatePlot.SetFillStyle(1001)
# jetToPhotonRatePlot.SetLineWidth(2)
# jetToPhotonRatePlot.SetLineStyle(1)
ratePlot.Add(jetToMETRatePlot, "A3")
jetToMETRatePlot.SetFillStyle(1001)
jetToMETRatePlot.SetLineWidth(2)
jetToMETRatePlot.SetLineStyle(1)
ratePlot.Draw("A3")

# Plot labels
ratePlot.SetTitle("Zero pile-up event rate simulation")
ratePlot.GetXaxis().SetTitle("p_{t} [GeV]")
ratePlot.GetYaxis().SetTitle("Rate [Hz]")

leg.Draw()

# Plot ranges
ratePlot.GetYaxis().SetRangeUser(1e2, 1e10)
ratePlot.GetXaxis().SetRangeUser(30, 370)

# Lumi and energy info
text = TPaveText(0.2, 0.84, 0.6, 0.9, "NDC")
text.AddText("L_{inst} = 3 #times 10^{35} cm^{-2} s^{-1}   #sqrt{s} = 100 TeV")
text.Draw()

# Adding a reference line at 1 MHz

mhzLine = TLine(30, mySettings.yScale, 160, mySettings.yScale)
mhzLine.SetLineColor(2)
mhzLine.SetLineStyle(2)
mhzLine.Draw()

label_1MHz = TLatex(143, 1.1*mySettings.yScale, "1 MHz")
label_1MHz.SetTextSize(0.04)
label_1MHz.Draw()

canvas.Update()
canvas.Draw()
canvas.Print("ratePlot.png", "png")
canvas.Print("ratePlot.svg", "svg")
canvas.Print("ratePlot.pdf", "pdf")
canvas.Print("ratePlot.C", "cxx")
